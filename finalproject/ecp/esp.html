<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../finalp.css">
<style>
        body{
            margin: 0;
            padding: 0;
            background-color: black; 
            color:white;
            display: flex;
            flex-direction: column;
            min-height: 100vh; /* 设置最小高度为视口高度 */

        }

        /*图片大小*/
       img{
        width: 900px;
        height: 600px;
        margin-left: 30px;
        }
        img.pic{
            width: 900px;
            height: 1000px;
        }
        video{
          width: 900px;
          height: 600px;
          margin-left: 30px;
        }

</style>
</head>
<body>
    <div id="sidebar">
        <!-- 侧边栏内容 -->
        <ul>
          <a href="#section1"><h5>A:XGZP6847 Air pressure sensor</h5></a>


          <a href="#section2"><h5>B: Full color RGB light</h5></a>

          
          <a href="#section3"><h5>C: ST7735 Screen</h5></a>


          <a href="#section4"><h5>D: DY1703A Audio playback module</h5></a>

          
          <a href="#section5"><h5>Ideal 5-Cutlery detector</h5></a>


          <a href="../finalproject.html"><h5>Return</h5></a>
        </ul>
      </div>
    <header>
        <h1>Electric Control Part</h1>
    </header>

    <h2>Overall electrical control logic diagram</h2>
    <img src="./cp/cp-1.jpg">

    <!--part1-->
    <section id="section1"><h2>A: Air pressure sensor</h2> 
    <img src="./cp-a/esp-1-12.png">
    <h3>A-1 Find the library file</h3>
    <img src="./cp-a/esp-1-1.png">
    <p>Open Arduino and open the file</p>
    <img src="./cp-a/esp-1-2.png">
    <p>Open the example and find <b>AnalogReadSerial</b> in <b>01 Basics</b> of the built-in example</p>
    <h3>A-2 Debug code value</h3>
    <p>Members Rosalynn and Cynthia in the group conducted experimental measurements of the minimum and 
    <br>maximum pressure values of the airbag respectively.</p>
    <h5>First, the value with less pressure is tested, and the measurement result is 205</h5>
    <img src="./cp-a/esp-1-3.jpg">
    <img src="./cp-a/esp-1-6.jpg">
    <img src="./cp-a/esp-1-5.png">
    <h5>The value of higher pressure was tested again, and the measurement result was 290</h5>
    <img src="./cp-a/esp-1-4.jpg">
    <img src="./cp-a/esp-1-7.jpg">
    <img src="./cp-a/esp-1-8.png">
    <h3>A-3 Circuit diagram</h3>
    <img src="./cp-a/esp-1-9.png">
    <h3>A-4 Physical connection mode</h3>
    <img src="./cp-a/esp-1-10.jpg">
    <img src="./cp-a/esp-1-11.jpg">
    <h4>A-5 Pneumatic fitting</h4>
    <p>Cuff accessories for mercury sphygmomanometer - Latex cuff liner</p>
    <img src="./cp-a/esp-1-13.png">
    <p>Mercury sphygmomanometer cuff accessory - Inflatable ball bag</p>
    <img src="./cp-a/esp-1-14.png">
    <p><b>The reason why we chose this accessory:</b></p>
    <p>1.The inner liner is made of latex, which is stronger than the film we previously selected, 
    <br>resistant to pressure and puncture, and not easily broken.
    <br>2.These two accessories are medical appliances, safety and sealing are more guaranteed.
    <br>3.The accessories are connected with the inflatable air bag, which is convenient for inflating 
    <br>and replenishing air.</p>
        
       
        
    <!--part2-->
    <section id="section2"><h2>B: Full color RGB light</h2> 
    <h3>B-1 Function Introduction</h3>
    <p>LED lights as indicators, the function is to show the size of the pressure through different colors 
    <br>of light.
    <br>When the pressure is less than 205, the LED lights green, indicating that the pressure is at a low 
    <br>level.
    <br>When the pressure is between 205 and 290 units, the LED lights blue, indicating moderate pressure.
    <br>When the pressure is greater than 290 units, the LED lights red, indicating that the pressure is 
    <br>higher.
    <br>This setting allows the user to intuitively understand the pressure state and make judgments or take 
    <br>actions based on different colors. </p>
    <h3>B-2 Arduino</h3>
    <pre><code>
        //2024.6.19 by JinXuan
        // Define the pins connected to the Arduino
        const int sensorPin = A0;    // Pressure sensor connected to A0
        const int switchPin = 2;     // Switch connected to D2
        const int redLEDpin = 3;      // Red LED connected to D3
        const int blueLEDpin = 5;      // Blue LED connected to D5
        const int greenLEDpin = 4;    // Green LED connected to D4
        
        // Define thresholds
        const int lowThreshold = 205; // Low pressure threshold
        const int highThreshold = 290; // High pressure threshold
        
        void setup() {
          Serial.begin(9600);         // Initialize serial communication
          pinMode(sensorPin, INPUT); // Set the pressure sensor pin as input
          pinMode(switchPin, INPUT_PULLUP); // Set the switch pin as input and enable internal pull-up resistor
          pinMode(redLEDpin, OUTPUT); // Set the red LED pin as output
          pinMode(greenLEDpin, OUTPUT); // Set the green LED pin as output
          pinMode(blueLEDpin, OUTPUT); // Set the blue LED pin as output
        }
        void loop() {
          // Read the analog value from the pressure sensor
          int sensorValue = analogRead(sensorPin);
        
          if (sensorValue &lt; lowThreshold && sensorValue &gt; 10) {
            digitalWrite(greenLEDpin, HIGH); // Turn on the green LED
            digitalWrite(redLEDpin, LOW);   // Turn off the red LED
            digitalWrite(blueLEDpin, LOW);   // Turn off the blue LED
          } else if (sensorValue &gt; highThreshold) {
            digitalWrite(greenLEDpin, LOW);   // Turn off the green LED
            digitalWrite(redLEDpin, HIGH);  // Turn on the red LED
            digitalWrite(blueLEDpin, LOW);   // Turn off the blue LED
          } else {
            digitalWrite(greenLEDpin, LOW);   // Turn off the green LED
            digitalWrite(redLEDpin, LOW);    // Turn off the red LED
            digitalWrite(blueLEDpin, HIGH);  // Turn on the blue LED
          }
        
          // Add a short delay to avoid high CPU usage
          delay(90);
        }
        
    </code></pre>
    <h3>B-3 Circuit diagram</h3>
    <img src="./cp-b/cp-b-1.png">
    <h3>B-4 Physical connection mode</h3>
    <img src="./cp-b/cp-b-2.JPG">
    <h3>B-5 Physical effect</h3>
    <img src="./cp-b/cp-b-3.gif">


    

    <!--part3-->
    <section id="section3"><h2>C: ST7735 Screen</h2>  
    <img src="./cp-c/cp-c-9.png">
    <h3>C-1 Function Introduction</h3>
    <p>Through the number of pressure sensors, judge the user's pressure value interval at the moment, and 
    <br>the corresponding heartbeat rate will be accelerated if the pressure value is too large. Through 
    <br>the screen, we draw an animation of the heartbeat, and through the change of the heartbeat frequency, 
    <br>we can visualize the user's pressure value.</p>
    <h3>C-2 Arduino</h3>
    <h4>1. Library file configuration</h4>
    <p>step1: Open the Admin library in the arduino toolbar</p>
    <img src="./cp-c/cp-c-1.jpg">
    <p>step2: Search for ST7735 and GFX, download the library files in the picture box and use them.</p>
    <img src="./cp-c/cp-c-2.PNG">
    <img src="./cp-c/cp-c-3.PNG">
    <h4>2. Application code</h4> 
    <pre><code>
      //2024.6.22 by Jin Cancan
      #include &lt;Adafruit_ST7735.h&gt; // Contains the ST7735 library
      #include &lt;Adafruit_GFX.h&gt;   // Contains the GFX library
      // Defines the connection pins for the display
      #define TFT_RST 10
      #define TFT_DC 9
      #define TFT_CS 8
      #define TFT_MOSI 11  // Data out
      #define TFT_SCLK 13  // Clock out
      const int sensorPin = A0;    
      const int lowThreshold = 180; 
      const int highThreshold = 250;
      int AT=1000;
      unsigned long T0;
      unsigned long myTime;
      Adafruit_ST7735 tft = Adafruit_ST7735(TFT_CS, TFT_DC, TFT_RST);
      
      void setup() {
        pinMode(sensorPin, INPUT);
        tft.initR(INITR_BLACKTAB); // Initialize the display, where the black Tab is used
        tft.fillScreen(ST7735_BLACK); // Fill the screen with black
      }
      
      void drawHeart(int x, int y, int heartsize) {
        // Calculate the coordinates of the heart vertex
        int topX = x;
        int topY = y + heartsize / 2;
        int leftX = x - heartsize / 2;
        int leftY = y ;
        int rightX = x + heartsize / 2;
        int rightY = y ;
      
        // Draw the apex of the heart shape
        tft.fillTriangle(leftX, leftY, topX, topY, rightX, rightY, ST7735_RED);
      
        // Calculate the coordinates of the circular part
        int circleSize = heartsize / 3;
        int leftCircleX = x - heartsize / 4;
        int leftCircleY = y - heartsize / 4 + 1;
        int rightCircleX = x + heartsize / 4;
        int rightCircleY = y - heartsize / 4 + 1;
      
        // Draw a circle
        tft.fillCircle(leftCircleX, leftCircleY, circleSize, ST7735_RED);
        tft.fillCircle(rightCircleX, rightCircleY, circleSize, ST7735_RED);
      }
      void loop() {
        tft.fillScreen(ST7735_BLACK);
        myTime = millis();
        T0=myTime;
        int x = tft.width() / 2;
        int y = tft.height() / 2;
        int sensorValue = analogRead(sensorPin);
        
          if (sensorValue &lt; lowThreshold&&sensorValue>10) {
            AT=1000;
          } else if (sensorValue &gt; highThreshold) {
            AT=200;
          }else{
            AT=600;
          }
        do{
        // Draw love
        // Calculate the size and position of the heart and make sure it is in the center of the screen
         
        if(AT&gt;(millis()-T0)&&(millis()-T0)&gt;=0){ 
        int heartSize = min(tft.width() / 3, tft.height() / 3);
        drawHeart(x, y, heartSize);}
        if((2*AT)&gt;(millis()-T0)&&(millis()-T0)&gt;=AT){
        int heartSize2 = min(tft.width() / 2.5, tft.height() / 2.5);
        drawHeart(x, y, heartSize2);
        }
        if((millis()-T0)&gt;=(2*AT)){
        int heartSize3 = min(tft.width() / 2 , tft.height() / 2);
        drawHeart(x, y, heartSize3);
        }
      }while((millis()-T0)&lt;=(3*AT));
      }
    </code></pre>
    <h3>C-3 Circuit diagram</h3>
    <img src="./cp-c/cp-c-4.jpg">
    <h3>C-4 Physical connection mode</h3>
    <img src="./cp-c/cp-c-5.jpg" >
    <h3>C-5 Physical effect</h3>
    <h4>When the pressure value is normal</h4>
    <img src="./cp-c/cp-c-6.gif"class="pic">
    <h4>When the pressure is a little high</h4>
    <img src="./cp-c/cp-c-7.gif"class="pic">
    <h4>The pressure value is too high</h4>
    <img src="./cp-c/cp-c-8.gif"class="pic">


    <!--part4-->
    <section id="section4"><h2>D: DY1703A Audio playback module</h2>
    <img src="./cp-d/cp-d-1.png">
    <h3>D-1 Function introduction</h3>
    <p>The main purpose of the sound module is to help the user relieve the current mood.
    <br>When the pressure is less than 205, no sound is made.
    <br>When the pressure is between 205 and 290, soothing music will be emitted to help the user relax.
    <br>When the pressure is greater than 290, a breathing guidance sound is issued, prompting the user 
    <br>to take deep breaths to reduce stress.
    <br>Relief is provided through different types of sound cues.</p>
    <h3>D-2 Selected voice</h3>
    <p>When faced with stress, music and meditation are two widely recognized ways to reduce stress.
    <br>1-Soothing music choice: "small rainbows" this song is ideal for soothing music with its soft melody 
    <br>and slow tempo. From a neuroscience perspective, music can directly affect areas of the brain 
    <br>associated with mood and stress. When we listen to music with a slow tempo and harmonious pitch, 
    <br>the brain releases "happy hormones" such as dopamine, chemicals that reduce anxiety levels and elevate 
    <br>our emotional state. In addition, the lyrics of "small rainbows" are healing, stimulating our inner 
    <br>positivity and helping us stay optimistic and resilient in the face of stress.</p>
    <img src="./cp-d/cp-d-2.jpeg">
    <p>2-The choice of breathing guidance: Breathing guidance in meditation is a very effective way to reduce 
    <br>stress. Breathing is one of the most basic physiological functions of our body, and it is closely 
    <br>related to our emotional state. By controlling the depth and frequency of breathing, we can adjust the 
    <br>balance of the autonomic nervous system, thereby reducing the body's stress response. These physiological 
    <br>changes help us to enter a more calm and relaxed state and thus better cope with life's challenges and 
    <br>stresses.</p>
    <h3>D-3 Arduino code</h3>
    <pre><code>
//2024.6.22 by JinXuan
const int sensorPin = A0; // Pressure sensor connected to A0
const int lowThreshold = 205; // Low pressure threshold
const int highThreshold = 290; // High pressure threshold
const int playPin = 6; // Relaxing music
const int playPin2 = 7; // Breathing guidance

void setup() {
Serial.begin(9600);
pinMode(sensorPin, INPUT); // Set the pressure sensor pin as input
pinMode(playPin, OUTPUT); // Output
pinMode(playPin2, OUTPUT); // Output
}

void loop() {
int sensorValue = analogRead(sensorPin);
Serial.println(sensorValue);
delay(1);
if (sensorValue &lt; lowThreshold) {
digitalWrite(playPin, HIGH);
digitalWrite(playPin2, HIGH);
delay(500); // No sound
} else if (sensorValue &grave; highThreshold) {
digitalWrite(playPin, HIGH);
digitalWrite(playPin2, LOW);
delay(20000); // Breathing guidance
} else {
digitalWrite(playPin, LOW);
digitalWrite(playPin2, HIGH);
delay(20000); // Relaxing music
}
}
    </code></pre>
    <h3>D-4 Circuit connection diagram</h3>
    <img src="./cp-d/CP-d-3.png">
    <h3>D-5 Physical connection diagram</h3>
    <img src="./cp-d/cp-d-4.JPG">
    <h3>D-6 Video presentation</h3>
    <video src="./cp-d/cp-d-5.mp4" controls></video>
